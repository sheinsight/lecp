# å¿«é€Ÿå¼€å§‹

import { PackageManagerTabs } from '@theme'

## å®‰è£…

<PackageManagerTabs
  command="install @shined/lecp -D"
/>

å®‰è£…å®Œæˆåï¼Œä½ å¯ä»¥åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ `lecp` å‘½ä»¤æˆ–é€šè¿‡é…ç½®æ–‡ä»¶è¿›è¡Œæ„å»ºã€‚

:::tip
lecp éœ€è¦åœ¨ **node@20.19.0+** ç¯å¢ƒä¸‹è¿è¡Œ, æ”¯æŒ require(esm)
:::

### tsconfig.json

typescript å‡ ä¹æ˜¯ npm åŒ…çš„æ ‡é…ã€‚è‡ªåŠ¨ç”Ÿæˆ dts æ–‡ä»¶æ˜¯å¿…ä¸å¯å°‘çš„ã€‚

æˆ‘ä»¬éœ€è¦é…ç½® é¢å‘ esm + bundler å‹å¥½çš„ tsconfig.jsonã€‚

```json
{
  "compilerOptions": {
    /* modules */
    "target": "ESNext",
    "module": "Preserve",
    "verbatimModuleSyntax": true,
    "allowImportingTsExtensions": true,

    /* lint */
    "strict": true,
    "noUncheckedSideEffectImports": true,

    /* perf */
    "skipLibCheck": true,
    // "isolatedDeclarations": true,

    /* dts */
    "noEmit": true,
    "declaration": true,
    "declarationMap": true
  }
}
```

LECP ä½¿ç”¨ SWC ç”Ÿæˆ jsï¼Œä¸ºäº†è·å¾—æœ€ä½³æ€§èƒ½å’Œå…¼å®¹æ€§ï¼Œå»ºè®®ä½¿ç”¨ä»¥ä¸Šé…ç½®ã€‚

:::details tsconfig é…ç½®è¯´æ˜

**æ¨¡å—ç³»ç»Ÿé…ç½®ï¼š**

- `"module": "Preserve"`: ä¿ç•™åŸå§‹æ¨¡å—è¯­æ³•ï¼Œè®©æ„å»ºå·¥å…·å¤„ç†æ¨¡å—è½¬æ¢
- `"verbatimModuleSyntax": true`: ç¡®ä¿ç±»å‹å¯¼å…¥/å¯¼å‡ºè¯­æ³•çš„å‡†ç¡®æ€§
- `"allowImportingTsExtensions": true`: å…è®¸å¯¼å…¥ `.ts` æ‰©å±•åæ–‡ä»¶

**ä¸¥æ ¼æ¨¡å¼é…ç½®ï¼š**

- `"strict": true`: å¯ç”¨æ‰€æœ‰ä¸¥æ ¼ç±»å‹æ£€æŸ¥
- `"noUncheckedSideEffectImports": true`: æ£€æŸ¥å‰¯ä½œç”¨å¯¼å…¥

**æ€§èƒ½ä¼˜åŒ–ï¼š**

- `"skipLibCheck": true`: è·³è¿‡åº“æ–‡ä»¶ç±»å‹æ£€æŸ¥ä»¥æå‡æ€§èƒ½
- `"isolatedDeclarations": true`: (å¯é€‰) å¯ç”¨ç‹¬ç«‹å£°æ˜æ¨¡å¼

**å£°æ˜æ–‡ä»¶é…ç½®ï¼š**

- `"noEmit": true`: TypeScript ä¸ç”Ÿæˆæ–‡ä»¶ï¼Œç”± LECP å¤„ç†
- `"declaration": true`: ç”Ÿæˆ `.d.ts` æ–‡ä»¶
- `"declarationMap": true`: ç”Ÿæˆå£°æ˜æ–‡ä»¶æ˜ å°„,ä¾¿äºè°ƒè¯•ã€‚

> ğŸ’¡ **æ³¨æ„**: è¿™äº›é…ç½®éµå¾ª [SWC è¿ç§»æŒ‡å—](https://swc.rs/docs/migrating-from-tsc) çš„è¦æ±‚ï¼Œç¡®ä¿ä¸ SWC ç¼–è¯‘å™¨çš„å…¼å®¹æ€§ã€‚

:::

## Node åŒ…

å¯¹äº Node å¹³å°åŒ…ï¼ˆå¦‚ SDKã€å·¥å…·åº“ç­‰ï¼‰ï¼Œæ¨èä»¥ä¸‹é…ç½®

### åˆ›å»ºé…ç½®æ–‡ä»¶

åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `lecp.config.ts` æ–‡ä»¶ï¼š

```typescript
import { defineConfig } from "@shined/lecp";

export default defineConfig({
  // è¾“å‡ºæ ¼å¼ï¼šæ”¯æŒ ES Module å’Œ CommonJS
  format: [
    { type: "esm" },
    { type: "cjs" }, // å¯é€‰ï¼šç›®å‰ç¯å¢ƒæ˜¯ node 20.19.0+ (require(esm)), å¯ä»¥å…³é—­
  ],

  // ç›®æ ‡ç¯å¢ƒ
  targets: {
    node: "20.11.0",
  },

  // ç”Ÿæˆ TypeScript å£°æ˜æ–‡ä»¶
  dts: true,

  // å¯ç”¨ shims ä»¥æä¾›æ›´å¥½çš„å…¼å®¹æ€§
  shims: true,
});
```

### è¾“å‡ºç»“æ„

- package.json çš„ type: "module"

```
dist/
â”œâ”€â”€ es/          # ES Module æ ¼å¼
â”‚   â”œâ”€â”€ index.js
â”‚   â”œâ”€â”€ index.d.ts
â”‚   â”œâ”€â”€ **/*.js
â”‚   â””â”€â”€ **/*.d.ts
â””â”€â”€ lib/          # CommonJS æ ¼å¼
    â”œâ”€â”€ index.cjs
    â”œâ”€â”€ index.d.cts
    â”œâ”€â”€ **/*.cjs
    â””â”€â”€ **/*.d.cts
```

- package.json çš„ type: "commonjs"

```
dist/
â”œâ”€â”€ es/          # ES Module æ ¼å¼
â”‚   â”œâ”€â”€ index.mjs
â”‚   â”œâ”€â”€ index.d.mts
â”‚   â”œâ”€â”€ **/*.mjs
â”‚   â””â”€â”€ **/*.d.mts
â””â”€â”€ lib/          # CommonJS æ ¼å¼
    â”œâ”€â”€ index.js
    â”œâ”€â”€ index.d.ts
    â”œâ”€â”€ **/*.js
    â””â”€â”€ **/*.d.ts
```

### package.json

å»ºè®®åœ¨ `package.json` ä¸­æ·»åŠ  `exports` å’Œ `files` å­—æ®µï¼š

**type: "module"**

```json
{
  "exports": {
    ".": {
      "import": "./es/index.js",
      "require": "./lib/index.cjs"
    },
    "./package.json": "./package.json"
  },
  "files": [
    "es",
    "lib"
  ]
}
```

**type: "commonjs"**

```json
{
  "exports": {
    ".": {
      "import": "./es/index.mjs",
      "require": "./lib/index.js"
    },
    "./package.json": "./package.json"
  },
  "files": [
    "es",
    "lib"
  ]
}
```

:::tip

- `exports` æ— éœ€è®¾ç½® `types` å€¼ ï¼Œtypescript ä¼šè‡ªåŠ¨æ ¹æ® import å’Œ require çš„å€¼æ¨æ–­ `types`çš„å€¼ã€‚
- æ²¡æœ‰è®¾ç½® `main/module/types` å­—æ®µ, å› ä¸ºè¿™äº›å­—æ®µå·²ç»è¢« `exports` å­—æ®µå–ä»£, åŸºæœ¬æ— éœ€è€ƒè™‘è¯¥å…¼å®¹æ€§ã€‚
- éœ€è¦æš´éœ²å­è·¯å¾„ï¼Œå¯ä»¥ç»§ç»­æ·»åŠ  `exports` å­—æ®µ,ä¾‹å¦‚:

```json
{
  "exports": {
    "./lib/*": "./lib/*.js",
    "./lib/*.js": "./lib/*.js",
    "./lib/*.cjs": "./lib/*.cjs",
    "./es/*": "./es/*.js",
    "./es/*.js": "./es/*.js",
    "./es/*.mjs": "./es/*.mjs",
  }
}
```

:::

## Web åŒ…é…ç½®

å¯¹äº Web å¹³å°åŒ…ï¼ˆå¦‚ React ç»„ä»¶åº“ç­‰ï¼‰ï¼Œæ¨èä»¥ä¸‹é…ç½®ï¼š

### åˆ›å»ºé…ç½®æ–‡ä»¶

åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `lecp.config.ts` æ–‡ä»¶ï¼š

```typescript
import { defineConfig } from "@shined/lecp";

export default defineConfig({
  // è¾“å‡ºæ ¼å¼ï¼šä¸»è¦æ”¯æŒ ES Moduleï¼Œå¯é€‰ UMD
  format: [
    { type: "esm" },
    { type: "umd" }, // å¯é€‰ï¼šç”¨äº CDN å¼•ç”¨
  ],

  // ç›®æ ‡æµè§ˆå™¨
  targets: {
    chrome: 55,
    safari: 12,
  },

  // ç”Ÿæˆ TypeScript å£°æ˜æ–‡ä»¶
  dts: true,

  // éœ€è¦æ”¯æŒ React 16.x ç‰ˆæœ¬ï¼Œéœ€è¦è®¾ç½®ä¸º "classic"
  // react: {
  //   jsxRuntime: "classic",
  // },

  // CSS å¤„ç†
  css: {
    cssModules: true,    // å¯ç”¨ CSS Modules(ä¸æ¨è)
  },
});
```

:::tip
é¢å‘æµè§ˆå™¨çš„åŒ…ï¼Œåœ¨ä»Šå¤©å·²ç»æ— éœ€è®¾ç½® cjs æ ¼å¼ã€‚
:::

### è¾“å‡ºç»“æ„

```
dist/
â”œâ”€â”€ es/              # ES Module æ ¼å¼
â”‚   â”œâ”€â”€ index.js
â”‚   â”œâ”€â”€ index.d.ts
â”‚   â”œâ”€â”€ Button/
â”‚   â”‚   â”œâ”€â”€ index.js
â”‚   â”‚   â”œâ”€â”€ index.d.ts
â”‚   â”‚   â””â”€â”€ index.css
â”‚   â””â”€â”€ ...
â””â”€â”€ umd/              # UMD æ ¼å¼
    â””â”€â”€ index.js

```

### package.json

å»ºè®®åœ¨ `package.json` ä¸­æ·»åŠ  `exports` å’Œ `files` å­—æ®µï¼š

```json
{
  "exports": {
    ".": "./es/index.js",
    "./package.json": "./package.json"
  },
  "files": [
    "es",
    "umd"
  ]
}
```

## æ„å»º

è®¾ç½®å®Œ `lecp.config.ts` æ–‡ä»¶åï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œæ„å»ºã€‚

### å¸¸ç”¨å‘½ä»¤

```bash
# å¼€å‘æ¨¡å¼æ„å»ºï¼ˆç›‘å¬æ–‡ä»¶å˜åŒ–ï¼‰
npx lecp -w

# ç”Ÿäº§æ¨¡å¼æ„å»º
npx lecp

```

### package.json

å»ºè®®åœ¨ `package.json` ä¸­æ·»åŠ ä»¥ä¸‹è„šæœ¬ï¼š

```json
{
  "scripts": {
    "build": "lecp",
    "dev": "lecp -w"
  }
}
```

:::tip

å¼€å‘æ¨¡å¼ä¸‹ï¼Œlecp æ”¯æŒ `lecp.config.ts` å˜åŠ¨åè‡ªåŠ¨é‡å¯
:::
